<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaltsit</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- 全局样式 --- */
        body {
            margin: 0; padding: 0; height: 100vh;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            font-family: "Microsoft YaHei", sans-serif;
            background: url('https://bing.img.run/1920x1080.php') no-repeat center center fixed;
            background-size: cover;
            box-shadow: inset 0 0 0 1000px rgba(0, 0, 0, 0.1); 
        }

        /* --- 1. 搜索组件区域 --- */
        。search-container {
            width: 100%; max-width: 520px; 
            margin-bottom: 60px;
            position: relative; 
            z-index: 100; 
        }

        /* 搜索框外壳 */
        。search-wrapper {
            position: relative; width: 100%; height: 50px; border-radius: 50px;
            /* 主搜素框毛玻璃 */
            background: rgba(255, 255, 255, 0.25); 
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex; align-items: center;
            transition: all 0.3s ease;
            z-index: 10; /* 保证在下拉菜单之上 */
        }

        .search-wrapper:hover, .search-wrapper:focus-within {
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        /* 引擎切换按钮 */
        .engine-switch {
            width: 70px; height: 100%;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; color: #fff; font-size: 18px;
            border-right: 1px solid rgba(255,255,255,0.2);
            position: relative; gap: 5px;
        }
        .engine-switch:hover { background: rgba(255,255,255,0.1); border-radius: 50px 0 0 50px; }
        .arrow-down { font-size: 10px; opacity: 0.7; transition: transform 0.3s; }
        
        /* 当菜单打开时，小箭头旋转 */
        .engine-switch.active .arrow-down { transform: rotate(180deg); }

        /* 输入框 */
        .search-box {
            flex: 1; height: 100%; border: none; background: transparent;
            outline: none; padding: 0 20px; font-size: 16px; color: #fff;
        }
        .search-box::placeholder { color: rgba(255, 255, 255, 0.7); }

        /* --- 下拉菜单通用动画类 (关键修改) --- */
        .dropdown-menu-base {
            position: absolute; left: 0; 
            background: rgba(255, 255, 255, 0.25); /* 透明度调低，显现毛玻璃 */
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3); /* 增加高光边框 */
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            border-radius: 15px;
            overflow: hidden;
            
            /* 动画初始状态：隐藏、上移、透明 */
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* 贝塞尔曲线让动画更自然 */
        }

        /* 激活状态：显示、复位、不透明 */
        .dropdown-menu-base.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* 引擎选择菜单特定样式 */
        .engine-dropdown {
            top: 60px; width: 130px;
            flex-direction: column;
            display: flex;
            z-index: 20;
        }
        
        /* 联想词列表特定样式 */
        .suggestions-list {
            top: 60px; width: 100%;
            list-style: none; padding: 10px 0; margin: 0;
            z-index: 15;
        }

        /* 菜单项交互 */
        .engine-option, .suggestions-list li {
            padding: 12px 20px; cursor: pointer; color: #fff; /* 文字改为白色以适应深色背景，或深色加阴影 */
            text-shadow: 0 1px 2px rgba(0,0,0,0.5); /* 增加文字阴影防止在亮背景看不清 */
            font-size: 15px; display: flex; align-items: center; gap: 10px;
            transition: background 0.2s;
        }
        
        .engine-option:hover, .suggestions-list li:hover {
            background: rgba(255, 255, 255, 0.3); /* 悬浮加亮 */
        }
        
        .engine-option i { width: 20px; text-align: center; }

        /* --- 2. 图标区域 --- */
        .icon-container {
            display: flex; justify-content: center; flex-wrap: wrap; gap: 35px;
            width: 80%; max-width: 800px; z-index: 5;
        }
        .icon-item {
            text-decoration: none; display: flex; flex-direction: column; align-items: center;
            transition: transform 0.3s;
        }
        .icon-circle {
            width: 65px; height: 65px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 28px; color: #fff;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        .icon-item:hover { transform: translateY(-8px); }
        .icon-item:hover .icon-circle {
            background: rgba(255, 255, 255, 0.4); box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        /* --- 3. 设置组件 --- */
        .settings-btn { position: fixed; bottom: 20px; right: 20px; width: 40px; height: 40px; background: rgba(0,0,0,0.5); color: #fff; border-radius: 50%; border: none; cursor: pointer; z-index: 200; display: flex; justify-content: center; align-items: center; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 300; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: #fff; padding: 25px; border-radius: 12px; width: 90%; max-width: 480px; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; font-weight: bold; font-size: 18px;}
        .modal-body ul { list-style: none; padding: 0; }
        .modal-body li { display: flex; gap: 8px; margin-bottom: 10px; align-items: center; }
        .modal-body input { padding: 8px 10px; border: 1px solid #ddd; border-radius: 6px; flex: 1; outline: none; }
        .modal-body input:focus { border-color: #007bff; }
        .btn { padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; }
        .btn-red { background: #ff4d4f; color: white; }
        .btn-green { background: #52c41a; color: white; padding: 10px 20px; width: 100%; margin-top: 15px; font-size: 15px;}
        .close-btn { cursor: pointer; font-size: 24px; color: #888; }
    </style>
</head>
<body>

    <div class="search-container">
        <form id="searchForm" action="https://cn.bing.com/search" method="get" target="_blank">
            <div class="search-wrapper">
                <div class="engine-switch" id="engineSwitchBtn" title="切换搜索引擎">
                    <i class="fa-brands fa-microsoft" id="currentEngineIcon"></i>
                    <i class="fa-solid fa-caret-down arrow-down"></i>
                </div>
                <input type="text" name="q" id="searchInput" class="search-box" placeholder="Search Bing..." autocomplete="off" autofocus>
            </div>
        </form>

        <div class="dropdown-menu-base engine-dropdown" id="engineDropdown">
            <div class="engine-option" onclick="selectEngine('bing')">
                <i class="fa-brands fa-microsoft" style="color: #fff;"></i> Bing
            </div>
            <div class="engine-option" onclick="selectEngine('baidu')">
                <i class="fa-solid fa-paw" style="color: #fff;"></i> 百度
            </div>
            <div class="engine-option" onclick="selectEngine('google')">
                <i class="fa-brands fa-google" style="color: #fff;"></i> Google
            </div>
        </div>

        <ul class="dropdown-menu-base suggestions-list" id="suggestionsList"></ul>
    </div>

    <div class="icon-container" id="iconContainer"></div>

    <button class="settings-btn" onclick="openModal()"><i class="fa-solid fa-gear"></i></button>
    
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>管理快捷方式</span>
                <span class="close-btn" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <ul id="editList"></ul>
                <button class="btn btn-green" onclick="addNewItem()"><i class="fa-solid fa-plus"></i> 新增网站</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. 引擎逻辑 ---
        const engines = {
            bing:   { name: 'Bing',   url: 'https://cn.bing.com/search',      key: 'q',  icon: 'fa-brands fa-microsoft' },
            baidu:  { name: '百度',    url: 'https://www.baidu.com/s',         key: 'wd', icon: 'fa-solid fa-paw' },
            google: { name: 'Google', url: 'https://www.google.com/search',   key: 'q',  icon: 'fa-brands fa-google' }
        };
        
        let currentEngine = localStorage.getItem('searchEngine') || 'bing';

        function selectEngine(key) {
            currentEngine = key;
            const config = engines[key];
            document.getElementById('searchForm').action = config.url;
            document.getElementById('searchInput').name = config.key;
            document.getElementById('searchInput').placeholder = `Search ${config.name}...`;
            document.getElementById('currentEngineIcon').className = config.icon;
            
            // 使用 classList 控制显示/隐藏，触发动画
            document.getElementById('engineDropdown').classList.remove('show');
            document.getElementById('engineSwitchBtn').classList.remove('active');
            
            localStorage.setItem('searchEngine', key);
        }
        selectEngine(currentEngine);

        // --- 2. 搜索联想 ---
        const searchInput = document.getElementById('searchInput');
        const suggestionsList = document.getElementById('suggestionsList');

        searchInput.addEventListener('input', function() {
            const val = this.value.trim();
            if (!val) { 
                suggestionsList.classList.remove('show'); // 动画隐藏
                return; 
            }
            
            const script = document.createElement('script');
            script.src = `https://suggestion.baidu.com/su?wd=${encodeURIComponent(val)}&cb=window.baiduSuggestion`;
            document.body.appendChild(script);
        });

        window.baiduSuggestion = function(data) {
            const list = data.s;
            if (!list.length) { 
                suggestionsList.classList.remove('show');
                return; 
            }
            
            suggestionsList.innerHTML = '';
            list.slice(0, 6).forEach(text => {
                const li = document.createElement('li');
                li.innerHTML = `<i class="fa-solid fa-magnifying-glass" style="font-size:12px; opacity:0.7;"></i> ${text}`;
                li.onclick = () => {
                    searchInput.value = text;
                    document.getElementById('searchForm').submit();
                    suggestionsList.classList.remove('show');
                };
                suggestionsList.appendChild(li);
            });
            // 动画显示
            suggestionsList.classList.add('show');
            // 如果联想出现，强制关闭引擎菜单
            document.getElementById('engineDropdown').classList.remove('show');
        };

        // --- 3. 交互控制 ---
        document.getElementById('engineSwitchBtn').onclick = (e) => {
            e.stopPropagation();
            const dd = document.getElementById('engineDropdown');
            const btn = document.getElementById('engineSwitchBtn');
            const list = document.getElementById('suggestionsList');

            // 切换 active/show 类
            if (dd.classList.contains('show')) {
                dd.classList.remove('show');
                btn.classList.remove('active');
            } else {
                dd.classList.add('show');
                btn.classList.add('active');
                list.classList.remove('show'); // 打开引擎菜单时，关闭联想
            }
        };

        window.onclick = (e) => {
            if (e.target == document.getElementById('settingsModal')) closeModal();
            if (!e.target.closest('.search-container')) {
                // 点击外部，优雅关闭所有菜单
                document.getElementById('engineDropdown').classList.remove('show');
                document.getElementById('engineSwitchBtn').classList.remove('active');
                document.getElementById('suggestionsList').classList.remove('show');
            }
        };

        // --- 4. 网址管理 (不变) ---
        const defaultLinks = [
            { name: "Bilibili", url: "https://www.bilibili.com", icon: "fa-brands fa-bilibili" },
            { name: "GitHub",   url: "https://github.com",       icon: "fa-brands fa-github" },
            { name: "知乎",     url: "https://www.zhihu.com",    icon: "fa-brands fa-zhihu" },
            { name: "邮箱",     url: "https://mail.qq.com",      icon: "fa-solid fa-envelope" }
        ];
        let links = JSON.parse(localStorage.getItem('myLinks')) || defaultLinks;
        const container = document.getElementById('iconContainer');
        const editList = document.getElementById('editList');
        const modal = document.getElementById('settingsModal');

        function renderIcons() {
            container.innerHTML = '';
            links.forEach(link => {
                const a = document.createElement('a');
                a.className = 'icon-item'; a.href = link.url; a.target = '_blank'; a.title = link.name;
                a.innerHTML = `<div class="icon-circle"><i class="${link.icon}"></i></div>`;
                container.appendChild(a);
            });
        }
        function renderEditList() {
            editList.innerHTML = '';
            links.forEach((link, i) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <input type="text" value="${link.name}" placeholder="名称" onchange="updateLink(${i},'name',this.value)" style="flex:1">
                    <input type="text" value="${link.icon}" placeholder="图标" onchange="updateLink(${i},'icon',this.value)" style="flex:1">
                    <input type="text" value="${link.url}" placeholder="网址" onchange="updateLink(${i},'url',this.value)" style="flex:2">
                    <button class="btn btn-red" onclick="delLink(${i})"><i class="fa-solid fa-trash"></i></button>`;
                editList.appendChild(li);
            });
        }
        function updateLink(i, k, v) { links[i][k] = v; save(); }
        function delLink(i) { if(confirm('确定删除?')) { links.splice(i,1); renderEditList(); save(); } }
        function addNewItem() { links.push({name:'新网站', url:'https://', icon:'fa-solid fa-link'}); renderEditList(); save(); }
        function save() { localStorage.setItem('myLinks', JSON.stringify(links)); renderIcons(); }
        function openModal() { renderEditList(); modal.style.display = 'flex'; }
        function closeModal() { modal.style.display = 'none'; }
        renderIcons();
    </script>
</body>
</html>
